6.HDD

　HDD　補助記憶装置
	プラッタ(磁気ディスク)　データを記録保持するディスク
	スピンドルモータ　プラッタを回転させる　7200rpmなど
　	磁気ヘッド　スイングアームの先端　データを書き出す、プラッタに対し2倍の個数つく
	アクチュエータ　任意のトラック上に関係方向に移動するための動力
	プリント基板
		HDDコントローラ　すべての制御
		キャッシュメモリ　一時記憶による処理速度向上
		モータードライバー　プラッタを回転させるスピンドルモータや、アクチュエータを駆動する
				   　ボイスコイルモータなどを制御

　HDDの記録単位
	トラック　同心円状の記憶領域
	シリンダ　ディスク複数に対し各記憶面上の同一半径のトラック
	セクタ　円の中心から放射状に分割した領域、最小尾の記憶単位(512Byte)
	フォーマット　製造直後のHDDを記録できる状態にすること
	記憶容量 = 1セクターの容量*セクタ数*シリンダ数*磁気ヘッド
		磁気ヘッド　６
		シリンダ数　６００
		セクタ数　２００
		１セクタの容量　５１２Byte
		記憶容量 = 512 * 200 * 600 * 6 = 368MB

　読み書き
	プラットと磁気ヘッドの間にはわずかな隙間がある
	書き込み　コイルを流れる電流により磁気ヘッドが磁化され電磁コイルになり自足で信号を記録
	読み込み　コアに生じた磁界を打ち消すことによりディスク表面の磁化パターンを読み取る
　
　HDDの仕様	
	記憶容量が増えればキャッシュ容量も増える
	項目
	　	記憶容量
		アクセスタイム
		キャッシュ容量
　		省電力性、発熱量、静音

　インタフェイス
	サーバーとHDDを接続するには、両方のインタフェイス規格が同じである必要がある
	SATA　ATAの後継、シリアル転送方式を採用
	　　　1本に対し1台の接続のみ　→　ジャンパピンによるID設定不要
	　　　電源用、シリアル用、ジャンパピン（プラスティックでショートさせて設定）
	NCQ(Native Command Queuing)　SATA2.0から追加された機能
				　　 外側からデータを参照するのではなく、円状に最短経路で
				      データを読み取るためアクセス時間の軽減が図れる
	ATA(Advanced Technology Attachment)　HDD用に開発されたパラレル転送方式
					　　 マザーボード上に 2 つのコネクタ、Primary 、Secondaryを持つ 
　					　　 1コネクタにつき、2台までデバイスを接続できる
					     デバイスはジャンパピンにてMaster 、Slaveの設定を行う必要がある
					     ケーブルはATAフラットケーブルを使用コネクタは40ピン(アースを含め80ピン)		SAS(Serial Attached SCSI)　全二重通信(full duplex)のため受信送信を同時に並行して実行可
				　 今の主流はMini SAS HD、一回刺すと抜けないことが多発している
				   4つの物理リンクで1本のケーブルをさすため接続ディバイス増加によるっパフォーマンス低下がない
　	　　　			   接続デバイスは自動でSASアドレスが設定されるため、ID設定は不要
				　 エクスパンダを仲介することで多数のデバイスを接続できる
				   現在の最大転送速度は2400MB/s SAS4.0
				   8b/10b変換を用いる
				   SCSI同様、バックプレーンを用いてHDDのホットスワップが可能
				   SASインタフェースにSATAデバイスを接続することが可能 
				　 2.5インチのHDDがサポートされている(SATAも同様）
	SCSI(Small Computer System Interface)　デイジーチェーンというつなぎ方、数珠繋ぎみたいな、最後にターミネータを置く
					       使用するにはIDを振るなど面倒
					       パラレル転送方式のインタフェイスのため過去の遺物、化石レベル
					       ターミネータ　伝送信号の反射波を防ぐもの
					       SCSI-ID　重複しないよう番号を振る必要がある
　						　　　  ジャンパピンより2進数で15まで番号の振り分けができる
　
　SSD(Solid State Drive)　
	見た目的にも仕組み的にもメモリに近い
	依然として高価なため、スタンダードはSAS
	プラッタを持たないため高速に読み書きが可能
	インタフェイス　サーバーとSSDをつなぐ部分でSATAやSASが使用される
			 NVMe SSD  PCIe   ポータブルSSD USB
	SSDコントローラ　読み書きやデータのやり取りをする心臓部
			　SSDの性能が大きく左右される
	キャッシュメモリ　一時保存　
	フラッシュメモリ　1セルあたり1bit　SLC　耐久性が高いが容量が少なく高価
			　 　　　　　 2bit　MLC
			　　　　　　　3bit  TLC　大容量で安価だが耐久性がない
	ウェアレベリング処理　メモリに寿命があるため散らして使用しSSDの寿命を延ばす
	エラー訂正機能　ECCとデータを比較し誤りの有無確認、エラー訂正を行う
	不良ブロックの管理　壊れてしまったブロックが発生した場合、冗長ブロックに差し替える仕組み

　SMART機能　障害検知をし、LEDやベンダ特有の監視ツールで事前にユーザーに通知

　パラレル転送方式からシリアル転送方式
	スキュー　複数の信号線から同時に送り出された信号が受信側でばらついて到着する
	クロストーク　複数の信号線が相互に干渉する
	そもそもパラレル転送が間違えており上記がなくなるシリアル方式がメジャーになった

7.RAID
  
  複数台のHDDを1つのドライブのように認識、表示させる技術
  RAIDのメリット
	データの保護(冗長性)　1台のHDDに障害が発生してもデータが保持できる
	容量の拡大　複数のHDDを組み合わせて1つの大容量の論理ディスクを構築することができる
	処理速度の向上　HDDのアクセスを高速化することができる
　
　概念
	ストライピング　データをファイル単位でなくストライプサイズ(64-256KB)に分けて分散して記録
	　　　　　　　　すべてのHDDがなければ完全なデータにはならない
	　　　　　　　　理論上台数が増えるほどアクセス速度が増す
	ミラーリング　同一データを2台のHDDに記録する、使用可能容量が半分になる

　RAIDレベル　0-6レベルが存在し、組み合わせにより10,50,60などがある
　　	RAID0　1つの情報をブロック分割しパフォーマンス向上を図る、壊れると復旧不可のためパフォーマンス重視
	　　　 使用可能な容量は、組にしたHDDの総和となる
	RAID1　ミラーリング行う、信頼性は非常に高い
	RAID5　RAID Groupを構成するHDDの総数は3台以上
	　　　 訂正符号データをもとに情報を分散させて記録する方法
	　　　 1台が故障しても残りのデータとパリティから故障したHDDを復元することができる
	　　　 2台以上の復旧はできない
	RAID6　RAID5の応用、二重パリティ、4台以上で実装
	　　　 2台の復旧まで対応可能
	       パリティを大量に書くため処理が重い、あまり普及していないように感じる
	高レベルのRAID　
		RAID10　RAID1とRAID0の組み合わせ　2+2台　容量を拡大する場合
			ストライピングしたものをミラーリングする
		RAID50　RAID5とRAID0の組み合わせ　3+3台　転送速度の向上
			ストライピングしたものに対しパリティを生成する
		RAID60  RAID6とRAID0の組み合わせ　4+4台　転送速度の向上
			ストライピングしたものに対しパリティ2つを生成する	

　HWRAIDとSWRAID
	HWRAIDが一般的だがRAIDコントローラがなくてもOS上で処理できるSWRAIDがある
	SWRAIDはOSがこの処理をしてしまうためほかの処理が重くなってしまう
　
　RAIDコントローラ
	カード型　拡張スロットに差し込む型	
	内蔵型　マザボに組み込まれている
	ドータータイプ　マザボに拡張
　	Cache　次回高速にアクセスできるように格納しておくしくみ
	ReadCache　HDDから読み込んだデータの置き場
	WriteCache　WriteThrough
			CacheとＨＤＤ両方に書き込む方式
	          　WriteBack　
			Cacheに書き込んだ時点で書き込み完了になる
			まだHDDに書いてはいない、処理をないもしていないときにHDDに書き込む
			バッテリーを装備していることが一般的（Cacheが不揮発性のため）
	ホットスワップ　電源を入れた状態でHDDを交換できる
	ホットスペア　RAID公正とは別に待機させておく予備のHDD
	Rebuild　障害が発生したとき新しいRAIDを再構築すること
	

8.ファームウェア

　ファームウェアとはHWの基本的な制御を行うソフトウェアの総称
　マザボ上のフラッシュROMに組み込まれているものでBIOSというファームウェアがある
　
　BIOS
	POST(Power On Self Test)機能　HWの検出、正常に回路のチェックや初期化
				      POST中にエラーが検出されるとメッセージで表示する、ビープ音をならす
	OS起動機能　POSTが正常に終了するとBIOSがHDDのMBRを読みに行く
	HW設定ユーティリティ　POST実行中に特定のキーを押すと実行される
			　　　誤った設定にしてしまうとサーバーが起動しなくなったり周辺機器が認識されなくなる恐れあり
　
　Serverの起動
	BIOSの動き　電源投入時に真っ先に起動
		　　BIOSの設定内容に従い各HWが設定され、OSにHWの情報が引き渡される
	MBR(マスターブートレコード)　OSを格納しているディスクの先頭セクタに起動され、OSの起動をになう
	MBRの動き　最初に発見した＜BRにあるマスターブートストラップローダをメモリへ展開し制御を渡す
	　　　　　 ブートプログラムのコードなどを格納する部分
		　　p109-p111

　アプデの必要性　
	ファームウェアのリリースタイミングは不定期
	更新パッチのインストールを行うと同様にファームウェアのバージョンアップのアプデを行う場合もある
　
　UEFI(Unified Extensible Firmware Interface)
	現在のPCではBIOSではなくUEFIを使用していることが多い
	BIOSは2TB以上の対応はないがUEFIは対応している
	設定画面がグラフィカル
	

9.トラブルシューティング

　POSTが起動しない場合最初構成で問題の発見に取り組む
　POSTを完了できない、電源が入らない党の障害が発生した際に有効な手段
　BMC(Base Management Controller)　マザボに実装されている管理用IC
				　 特定のパラメータが閾値を超えると警告イベントやログイベントを送信する
　

10.バックアップ

　コンピュータに記録されたデータ、プログラムを損失や、ウィルスの艦船などの事態に備え別の媒体に記録すること
　リストア　障害が起きた時バックアップから復元することで障害が発生する以前の状態に戻すこと
　　　　　　バックアップとニコイチで初めて意味を持つ
　RAIDはバックアプデなく障害をカバーするもので、データの復元はできない
　
　必要性
	HW障害、人的ミス、SW障害、ウィルス、災害からデータを保護するため、冗長化、複製して安全な場所に保管が必要
	テープ　長年にわたりバクアップの主流を担ってきた
	　　　　信頼性、耐久性、大容量、高速性、可搬性のどれをとっても優れた性能と特徴を有している
	　　　　信頼性　衝撃、傷やほこり、少々の落下に耐えられる
	　　　　耐久性　30年の長期保存を前提に設計されている
	　　　　大容量　30TB(LTO8(規格)圧縮時)の容量を持ち、数百人分のPCデータを1巻きで保存できる
	　　　　高速性　900MB/sの速度を提供
	　　　　可搬性　オフィスが災害にあった場合に備え離れた場所に保管することが好ましい
	　　　　　　　　持ち運びが容易
	
　種類
	フルバックアップ　
		指定されたファイルをすべて一括してバックアップする
	　　　　差分バックアップや増分バックアップのベースにもなる
		常に1回分のバックアップデータからリストアが可能
		すべてを毎回バックアップするため作業時間がかかる
	増分バックアップ　
		前回のバックアップとの増分だけを取得する
		日々の変更分だけバックアップをするため、バックアップ量が少ない
		リストア時に使用するメディアが多くなり、リストアに時間がかかる
	差分バックアップ
		増分バックアップと同じようにデータの際をとる、しかしフルバックアップからの差分を取得
		リストア時2つのデータがあれば可能なため、増分バックアップより早くできる
		日を重ねるごとにバックアップ量が増大する
	アーカイブビット
		各ファイルが更新されているかを判断する要素として、ファイルに属性を付与する
		フラグが立ったら更新（バックアップ）の合図
	
　プランニング
	バックアップ対象
		どのデータをバックアップするか
	バックアップ先
		どの媒体へバックアップするか
		HDDやテープ装置、補助記憶装置が挙げられる
	バックアップスケジュール
		いつバックアップするか
		更新の少ないシステムは週1などシステムに合わせたプラン決めが推奨される
	世代管理
		過去にバックアップした時点にも復元できるような状態にしておくこと

　メディアローテーション（世代管理）
	使用するバックアップ装置やバックアップポリシーにより、正しいメディアローテーションを選択する必要がある
	Son方式
		一般的にシングルドライブ時に最もよく使用される
		平日は差分バックアップを行い、休日にフルバックアップを行う
		この方式で運用する場合は最低2巻以上のテープを使用し少なくとも週単位でメディアを交換しながら運用
	Father-Son方式
		Son方式と同じで平日は差分バックアップを行い、休日にフルバックアップを行う
		曜日毎でメディアを用意し、週末のフルバックアップの際に毎回異なるメディアを使用する
		Son方式より多くの世代を保存することが可能
	Grandfather-Father-Son(GFS)方式
		複数世代の保持はもちろんのこと月次でのフルバックアップを長期保存用として別途設定する
		テープのコストを押さえながら長期的なバックアップ計画を行える
	ハノイの塔方式
		少ないメディアコストで、フルバックアップデータをできるだけ長期間残すための方法
		数学的な議題等にもなる玩具に由来、△の塔を3つの棒を使って再生成するやつ
	アーカイブビット
		各ファイルが更新しているかの判断材料
		つけたり外したりすることにより増分、差分バックアップを実現している
	ストレージとテープライブラリの組み合わせ
		安価なディスクサブシステムを用いるケースが登場
		ディスクバックアップ（ストレージ）の容量は3U程度で容量は20TBくらい？
		D2T(Disk to Tape)
			ディスクサブシステムヵらテープストレージにバックアップを取る
			実績のある手法（テープに保存）
			小規模システムでは採用されているがある程度の規模を持つシステムは実装しない
		D2D(Disk to Disk)
			テープストレージの代わりにディスクサブシステムを使用する
			ディスクのほうが高価ではあるがバックアップの所要時間は短縮される
		D2D2T(Disk to Disk to Tape)
			ディスクサブシステムとテープストレージを用いて2段階のバックアップを行う手法
			ディスクに高速にバックアップを行い世代の古いものや長期保存したいものをテープに移管するもの
			中大規模で確実なデータ保護、運用管理のしやすさ、適切なデータ保管コストを提供できる
 

11.ファシリティ

　ラック　19インチの機器を搭載するためインチラックと呼ばれる
　　　　　
　ラックの規格
	19 * 1.75inch の整数倍がラックに搭載する機器
	→　1Uの倍数の単位でメーカー資料に記載されている
	構成手順
		１．必要とするラック搭載予定機器装置をリストアップ。
		２．ラック搭載機器の各々のスペース（U の単位）、電源容量 必要量等の合計を算出。
		３．合計ラックスペースから必要ラック数を決定。
		４．ラックへ搭載予定機器を図示。重量物はラック下部へ設置など考慮。
		５．各種ケーブルのタイプ・長さおよび必要数を決定。
	注意事項
		合計重量が設置場所の床荷重制限を超えないようにし、必要により床補強が必要
		占有する設置スペースを確保したうえでクリアランス、空調の確保が必要
		耐震免震面で、スタビライザー、アンカー、床固定、ISO-Baseを使用しServerラックの転倒を防ぐ
		コネクタのタイプによって用途が違う
			NEMA L5-20R  Lがlock、5または6で125V,250V,Rの前の数字がアンペアに対応
	コンソール
		サーバーが動作し続けることが目的のサーバーではほとんどコンソールを使用しない
		キーマウモニタ　大きいものは必要ないので14-15インチ程度の大きさ
		ラックのコンソール　複数のServerに対し1個のコンソールを共有する。
				　　 キーボード、ビデオ、マウスでKVMスイッチと呼ぶこともある
		
　
　Serverルーム　企業などにおけるサーバーを収納する部屋のことをさす
	セキュリティ　独立した部屋とし設置し、一般オフィスとの共用や他社オフィスとの隣接は避ける
		　　　危険物保管場所、火気施設、水道設備等、災害のリスクの大きい場所からは遠ざけて設置
		　　　外観は、目立ちにくいものとし、室名表示も最小限に留める必要
　　　　　　　	　　　出入り口は原則 1 ヶ所に限定し、施錠設備を設けなければならない
		　　　窓を設置することは極力避け、 設置する場合は網付きガラス・強化ガラス等を用いる
		　　　設置する機器・設備の重要度に応じて、防犯カメラ、侵入報知機等の防犯設備の設置を検討
		　　　非常電話、非常ベル等の非常用連絡設備の設置を検討しなければなりません
	　	　　　コピー機・ FAX 等、情報の複写や送信のための設備を設置してはなりません
	環境　熱暴走を防ぐため空調を一定に保つ
	　　　喚起や定期的な清掃をしなければならない
	　　　予備電源を設置しなければならない
	　　　アースを設置し、静電気を逃がすようにしなければならない
	　　　パワーサージを防ぐためUPSなどを設置する必要がある
	　　　ガス系消火設備を設置
	　　　作業員の静電対策をしなければならない

　データセンター
	ハウジングサービス　サーバーを預かり回線や保守を提供
	　　　　　　　　　　サーバー運用はユーザーの責任
	ホスティングサービス　自らが用意したサーバーを顧客に貸し出す
	　　　　　　　　　　　自社でサーバーを運用管理する必要がないためコストや人件費が抑えられる
	　　　　　　　　　　　仮想環境を使用することで、時間貸しが可能
	所在地　物理的な攻撃を受ける理由があるため一般的に住所は公開されない
	　　　　公開されていも大まかであり契約の意志を確認したうえで、正確な情報をお伝えする


12.ハンズオン

　作業時の注意点
	ESD対策　必ず静電マットを敷いて、アースをとりリストストラップをつける
	適切なツールの使用　ねじ山をつぶさないよう、適切なツールを
	メモを取る、スケッチをとる　外したねじやケーブルの位置を忘れないように
	マニュアルを確認する　正しい手順で部品を壊さないよう
	けが、感電に注意　必ずサーバーの電源をOFFにし、電源ケーブルを抜く
	　　　　　　　　　金属が鋭くなっている、高温になっている場合がある
	コネクタには触れない	皮脂が付着し腐食や接触不良を起こす
	コネクタの向き	接続の向きが決まっているものがあるため取り外す際に確認
	その他　貴金属類、ネクタイや社員証はとる、身のこなしに注意する
