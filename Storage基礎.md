# Storage基礎

## 担当
---
**野田さん**
 - 北海道全域のお客様機器の保守導入作業、GPU機器要員化に向け勉強中
  
**新保さん**
 - PureStorage製品の主管業務
---

## 到達目標
 - システムにおけるStorageが持つ役割を理解する
 - Storageの構成要素について理解する
 - Storageの接続形態(DAS、NAS、SAN)について理解する
 - HDDとSSDの違いについて理解する

---

## 1. Storage概要

### Storageとは
#### **Storage** ：データを置く場所（倉庫）、HDD、SSDなど
  - RAIDコントローラを強化、独立させた装置
  - メリット
    - 冗長化構成により無停止稼働
    - 複数のServerに接続するため容量を効率よく使える
    - 遠隔地、差分バックアップ等の独自機能による付加価値
    - 優れたパフォーマンス
      - より優れたCPU
      - より大容量のメモリ
      - より多くのドライブ搭載数
      
 #### 使命
- **データ保護** ：保管されているものを守る
- **サービスの継続**　：いつでも使える
- **十分な性能**　：データを素早く出し入れできる
 ---

### 記憶装置
 1000倍早い主記憶装置のみで構成できるのが理想だが....
  
| 名                   | 例 | 特徴                       | 価格 |
|----------------------------|------------|--------------------------------|--------|
| 主記憶装置         | DRAM        | `高価` `低容量` `揮発性`   | 16GB -> ¥8000  |
| 補助記憶装置             | HDD等        | `安価` `大容量` `不揮発性`  | 8TB -> ¥15000 |

 遅い補助記憶装置を加速するために工夫がされている
  - キャッシュメモリ：高速化
  - RAID：大容量化、高速化、冗長化
  - SSD：高速化
  - 仮想化：大容量化、高速化、効率化

---

### 実体
- OS(ほとんどがCustomizeLinux、Windows)とCPU、メモリ、HDDで動く　->　Serverと同じ
  - StorageはServerをベースに最適化したもの
  - Storage処理に特化したHWで構築される
- 増設する場合
  - **スケールアップ** ：容量のみ拡張可能
  - **スケールアウト** ：ノード（CPU + 容量)を拡張

#### 用途別

| 名                   | 特徴                       | 
|----------------------------|------------|
| ブロックStorage      | `内蔵ディスクと同じ感覚で使用可能` `SANブート可能`      |
| ファイルStorage             | `ファイル共有OSを搭載` `豊富なファイル共有機能`        | 
| オブジェクトStorage          | `大量,大容量コンテンツ配信/保存向け` |

#### 使用ドライブ別

| 名                   | 特徴                       | 
|----------------------------|------------|
| オールフラッシュStorage      | 全てフラッシュ(SSD)で構成 `高速` `やや高価`|
| ハイブリッドStorage             | HDDとSSDの混在で構成 `性能とコスパを両立`        | 
| HDD Storage          | 全てHDDで構成 `長年の実績` `ニアラインによる大容量化` |


---

## 2. HDD Storage

### 種類

| 名         | 正式名                       | 特徴 | 用途 |
|----------------------------|------------|-------|--------|
| SAS-HDD    | Serial Attached SCSI | `高性能` `高信頼性` `高価` | DB,仮想基盤,本番AP等 |
| SATA-HDD   | Serial ATA | `低性能` `低信頼性` `安価` | ファイル共有,開発用途 |
| NL-SAS     | Nearline-SAS | `低性能` `低信頼性` `安価` | ファイル共有,開発用途 |

- `制御基板(裏側)` ：HDDコントローラ、キャッシュメモリ、モニタードライバ
- `インターフェース`/`電源コネクタ` ：インターフェースはSASとSATA
- `アクチュエータ` ：ヘッドの位置を決める
- `スピンドルモータ` ：プラッタを回転させるモータ
- `スイングアーム` ：ヘッドを左右に動かす、ここのモータはシークモータと呼ぶ
- `磁気ヘッド` ：データを読む時期リーダとかく電磁石
- `プラッタ(磁気ディスク)` ：データが書きもまれる磁気を帯びた円盤

---

### 動き

#### 読み書きにかかる時間 = シークタイム + サーチタイム + データ転送時間

- **シーク** ：磁気ヘッドが目的のデータトラックに移動する時間
- **サーチ** ：目的のデータポジションが磁気ヘッドに回ってくるまでの時間
- **データ転送** ：目的のデータを転送(磁気ヘッドで読み書き)する時間

- データトラック：ぴらった上にある円状の記憶領域。トラックを分割した最小記憶単位は**セクタ**

#### アクセス(読み書き)方法

HDDは円盤であるが故にランダムアクセスが苦手

SSDはランダムアクセスも得意

| 名                   | 特徴                       | ---|
|----------------------------|------------|----------|
| シーケンシャルアクセス     | 順番に並んだデータにアクセス `高速`| 得意 | 
| ランダムアクセス           | ばらばらに配置されたデータにアクセス `低速`        | 不得意 |

---

### RAID

- ミラーリング：まったく同じデータを記憶(RAID1)
- ストライピング：RAIDを構成するドライブに分散
- SW RAID：独自のRAIDルールに基づきデータを保護

- ストライプ幅
  - データを分散させるドライブの数
  - RAID5 , RAID6 , RAID10 に当てはまる
  - 大きいほど**高性能**

- パリティ
  - 1台のディスクが故障した場合、残りのディスクとパリティ情報を用いて故障ディスクのデータを復旧できる
  - ストライピングでデータ部分から計算
  - `ライトペナルティ` ：計算が発生するためミラーリングより速度が少し落ちること
  - `RAID6` ：パリティ2つ、2本のディスク障害に対応
  - `RAID5` ：パリティ1つ、1本のディスク障害に対応
 
---

## 3. Storageアーキテクチャ

### 構成要素

| 名 | 構成要素 | 正式名 | 特徴 | 
|------|--------|----------|----------|
| シャーシ | 外殻 + ミッドプレーン(各構成要素を接続する中継基盤) | --- | --- | 
| Storage | シャーシ + 各構成要素(コントローラ + 電源 + HDD etc...) | --- | --- |
| SPOF | --- | Single Point of Failure | 単一故障点：ここで即時停止 `低故障率` |

